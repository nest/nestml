{#
  Generates code for emit_spike() function call
  @param ast ASTFunctionCall
#}
{%- if tracing %}/* generated by {{self._TemplateReference__context.name}} */ {% endif %}

// begin generated code for emit_spike() function
{%  if neuronName %}
{#-     emit_spike() called from within neuron #}
#ifdef DEBUG
std::cout << "[neuron " << this << "] Emitting a spike at t = " << nest::Time(nest::Time::step(origin.get_steps() + lag + 1)).get_ms() << "\n";
#endif
set_spiketime(nest::Time::step(origin.get_steps() + lag + 1));
nest::SpikeEvent se;
nest::kernel().event_delivery_manager.send(*this, se, lag);
{%- else %}
{#-     emit_spike() called from within synapse #}
e.set_receiver( *__target );

{%-     if nest_codegen_opt_delay_variable %}
{#      synaptic delay variable was explicitly set in code generator options #}
{%-         set var = utils.get_variable_by_name(astnode, nest_codegen_opt_delay_variable) %}
set_delay( {{ printer.print(var) }} );
const long __delay_steps = nest::Time::delay_ms_to_steps( get_delay() );
set_delay_steps(__delay_steps);
{%-     endif %}

{%      if ast.get_args() | length > 0 %}
{#          the weight was explicitly given as a parameter #}
e.set_weight( {{ printer.print(ast.get_args()[0]) }} );
{%-     else %}
{#          the default weight is 1 #}
e.set_weight( 1. );
{%-     endif %}
// use accessor functions (inherited from Connection< >) to obtain delay in steps and rport
e.set_delay_steps( get_delay_steps() );
e.set_rport( get_rport() );
e();
{%- endif %}
// end generated code for emit_spike() function
