{#
  Generates a series of C++ statements which perform one integration step of all ODEs that are solved by the analytic integrator.
#}
{%- if tracing %}/* generated by {{self._TemplateReference__context.name}} */ {% endif %}

{%- if uses_analytic_solver %}
{%-     for variable_name in analytic_state_variables_ %}
{%-         set update_expr = update_expressions[variable_name] %}
{%-         set var_ast = utils.get_variable_by_name(astnode, variable_name)%}
{%-         set var_symbol = var_ast.get_scope().resolve_to_symbol(variable_name, SymbolKind.VARIABLE)%}
{%-         if use_gap_junctions %}
const {{ type_symbol_printer.print(var_symbol.type_symbol) }} {{variable_name}}__tmp = {{ printer.print(update_expr) | replace("B_." + gap_junction_port + "_grid_sum_", "(B_." + gap_junction_port + "_grid_sum_ + __I_gap)") }};
{%-         else %}
{% set result = utils.check_if_statevar_depends_on_spikes(var_ast.name, neuron) %}
                {% if result == ["exc_spikes"] %}
const {{ type_symbol_printer.print(var_symbol.type_symbol) }} {{variable_name}}__tmp = {{ printer.print(update_expr) }} + {{ printer_no_origin.print(var_ast) }}_EX;
                {% elif result == ["inh_spikes"] %}
const {{ type_symbol_printer.print(var_symbol.type_symbol) }} {{variable_name}}__tmp = {{ printer.print(update_expr) }} + {{ printer_no_origin.print(var_ast) }}_IN;
                {% elif result == ["exc_spikes", "inh_spikes"] %}
const {{ type_symbol_printer.print(var_symbol.type_symbol) }} {{variable_name}}__tmp = {{ printer.print(update_expr) }} + {{ printer_no_origin.print(var_ast) }}_EX - {{ printer_no_origin.print(var_ast) }}_IN;
                {#                {% elif variable_name == 'I_syn_inh' %}#}
{#const {{ type_symbol_printer.print(var_symbol.type_symbol) }} {{variable_name}}__tmp = {{ printer.print(update_expr) }} + I_syn_inh_IN;#}
                {% else %}
const {{ type_symbol_printer.print(var_symbol.type_symbol) }} {{variable_name}}__tmp = {{ printer.print(update_expr) }};
                {% endif %}
{%-         endif %}
{%-     endfor %}
{%- endif %}
