# iaf_psc_exp_dend - Leaky integrate-and-fire neuron model with exponential PSCs
# #########################################################################
#
# Description
# +++++++++++
#
# iaf_psc_exp is an implementation of a leaky integrate-and-fire model
# with exponential-kernel postsynaptic currents (PSCs) according to [1]_.
# Thus, postsynaptic currents have an infinitely short rise time.
#
# The threshold crossing is followed by an absolute refractory period (t_ref)
# during which the membrane potential is clamped to the resting potential
# and spiking is prohibited.
#
# .. note::
#    If tau_m is very close to tau_syn_ex or tau_syn_in, numerical problems
#    may arise due to singularities in the propagator matrics. If this is
#    the case, replace equal-valued parameters by a single parameter.
#
#    For details, please see ``IAF_neurons_singularity.ipynb`` in
#    the NEST source code (``docs/model_details``).
#
#
# References
# ++++++++++
#
# .. [1] Tsodyks M, Uziel A, Markram H (2000). Synchrony generation in recurrent
#        networks with frequency-dependent synapses. The Journal of Neuroscience,
#        20,RC50:1-5. URL: https://infoscience.epfl.ch/record/183402
#
#
# See also
# ++++++++
#
# iaf_cond_exp

model update_block_variation_test:
    state:
        chan1_state real = 0.0
        chan1_global_state real = 0.0

        chan2_state real = 0.0
        chan2_global_state real = 0.0

        global_state real = 0.0

    parameters:
        chan1_activation real = 0.0
        chan2_activation real = 0.0

    equations:
        inline chan1 real = chan1_activation * (chan1_state + chan1_global_state)   @mechanism::channel
        inline chan2 real = chan2_activation * (chan2_state + chan2_global_state)   @mechanism::channel

    update:
        in_block_var real = global_state
        chan1_global_state = 2 * in_block_var

        if global_state > 0:
            chan2_global_state = 1
        elif global_state < 0:
            chan2_global_state = -1
        else:
            chan2_global_state = 0

        chan1_global_state = global_state
        chan2_global_state = global_state

